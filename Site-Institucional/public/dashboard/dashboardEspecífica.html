<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Específica Fármacos</title>
    <link rel="stylesheet" href="../styles/css-dash/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="../img/logo F png.png">
</head>

<body
    onload="exibirNomeDoEstabelecimentoDeTrabalho(), listarMaquinas(), kpisParametroCpu(), 
    kpisParametroRam(), kpiTempoDisco(), kpiRede(), informacoesMaquina()">
    <div class="conteudo">
        <div class="nav-lateral">
            <div class="logo-empresa">
                <img src="./../img/logo F png.png" alt="">
            </div>
            <div class="nav-itens">
                <li>
                    <ul><b id="nomeUsuario">Nome</b></ul>

                    <ul><a href="cadastroAlerta.html">Alertas</a></ul>
                    <ul><a class="atual" href="dashboardGeral.html">Máquinas</a></ul>
                    <ul><a href="./listaUsuario.html">Usuários</a></ul>
                    <ul><a href="./editarDados.html">Editar dados</a></ul>
                </li>
            </div>
            <div class="btn-pdf"><button>Gerar PDF</button></div>
            <div class="btn-voltar"><button>Voltar</button></div>
            <div class="btn-sair">
                <button>Sair</button>
            </div>
        </div>
        <div class="div-principal">
            <div class="nome-ame">
                <p>AME:</p>
                <p id="teste"></p>
            </div>

            <div class="div-superior">
                <div class="div-cpu">
                    <h2>CPU</h2>
                    <div class="descricao-componente">
                        <img src="../img/aviso (1).png" alt="">
                        <p>Preocupante: </p>
                        <p id="cpuPreocupante"></p>
                    </div>
                    <div class="descricao-componente">
                        <img src="../img/aviso.png" alt="">
                        <p>Critico: </p>
                        <p id="cpuCritico"></p>
                    </div>
                </div>
                <div class="div-ram">
                    <h2>Memoria RAM</h2>
                    <div class="descricao-componente">
                        <img src="../img/aviso (1).png" alt="">
                        <p>Preocupante: </p>
                        <p id="ramPreocupante"></p>
                    </div>
                    <div class="descricao-componente">
                        <img src="../img/aviso.png" alt="">
                        <p>Critico: </p>
                        <p id="ramCritico"></p>
                    </div>

                </div>
                <div class="div-rede">
                    <h2>REDE</h2>
                    <div class="descricao-componente">
                        <img src="../img/aviso (1).png" alt="">
                        <p>Preocupante: </p>
                        <p id="redePreocupante"></p>
                    </div>
                    <div class="descricao-componente">
                        <img src="../img/aviso.png" alt="">
                        <p>Critico: </p>
                        <p id="redeCritico"></p>
                    </div>
                </div>
                <div class="div-disco">
                    <h2>DISCO</h2>
                    <div class="descricao-componente">
                        <img src="../img/aviso (1).png" alt="">
                        <p>Preocupante: </p>
                        <p id="discoPreocupante"></p>
                    </div>
                    <div class="descricao-componente">
                        <img src="../img/aviso.png" alt="">
                        <p>Critico: </p>
                        <p id="discoCritico"></p>
                    </div>
                </div>
            </div>
            <div class="div-central">
                <div class="info-maquina">
                    <div class="titulo-lista-maquina">
                        Informações da máquina
                    </div>
                    <div class="nome-maquina" id="nomeMaquina">
                    </div>
                    <div class="conjunto-maquina" id="listagem-info-maquina">

                    </div>
                </div>
                <div class="div-rede-disco">
                    <div class="uso-sem">

                        <table>
                            <tr>
                                <th>Uso MG semanal</th>
                                <th>Espaço Livre</th>
                                <th>Previsão de acabar armazenamento</th>
                            </tr>
                            <tr>
                                <th>50</th>
                                <th>200</th>
                                <th>1490</th>
                            </tr>
                        </table>
                    </div>

                </div>

                <div class="div-list-maquinas-esp">
                    <h2>Lista de Máquinas</h2>
                    <table>
                        <tr>
                            <th><a href="dashboardGeral.html"> Geral</a></th>
                        </tr>
                        <tr>
                            <th id="listaDeMaquinas"><a href="dashboardEspecífica.html"></a></th>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="div-inferior">
                <div class="div-graf-rede"
                    style=" display: flex; align-items: center; justify-content: center; padding: 5px;">
                    <canvas id="myChart2" style="width: 400px; height: 300px;"></canvas>
                </div>
                <div class="div-graf-cpu"
                    style=" display: flex; align-items: center; justify-content: center; padding: 5px;">
                    <canvas id="myChart1" style="width: 400px; height: 260px;"></canvas>
                </div>
                <div class="div-list-alertas"
                    style=" display: flex; align-items: center; justify-content: center; padding: 5px;">
                    <canvas id="myChart3" style="width: 400px; height: 220px;"></canvas>
                    </table>
                </div>
            </div>

            <!-- <canvas id="myChart3" style="width: 250px; height: 200px;"></canvas> -->


        </div>
    </div>
</body>

</html>

<script>
    const btnPrint = document.querySelector(".btn-pdf");
    btnPrint.addEventListener("click", () => {

        const navLateral = document.querySelector(".nav-lateral"); // Supondo que "nav-lateral" é uma classe
        const divPrincipal = document.querySelector(".div-principal");

        if (navLateral) {
            navLateral.style.display = "none";
        }

        if (divPrincipal) {
            divPrincipal.style.width = "100%";
            divPrincipal.style.left = "0%";
        }
        // Cria uma folha de estilo CSS dinâmica para a impressão
        const printStyles = `
                @page {
                    size: A3 landscape; /* Tamanho da folha, pode ser A4, letter, legal, etc. */
                    margin: 1cm; /* Margens da página (por exemplo, 1cm em todos os lados) */
                }
            `;
        const style = document.createElement('style');
        style.textContent = printStyles;
        document.head.appendChild(style);

        // Inicia o diálogo de impressão
        window.print();

        if (navLateral) {
            navLateral.style.display = "flex";
        }

        if (divPrincipal) {
            divPrincipal.style.width = "81%";
            divPrincipal.style.left = "19%";
        }

        // Remove a folha de estilo após a impressão
        style.remove();
    });

    const ctx1 = document.getElementById('myChart1');

    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: [1, 2, 3, 4, 5, 6,],
            datasets: [
                {
                    label: 'Máquina 1',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: '#00323c',
                    borderColor: '#00323c',
                    borderWidth: 3
                },
                {
                    label: 'Uso de RAM',
                    data: [12, 19, 30, 50, 20, 30],
                    backgroundColor: '#00d5ffb9',
                    borderColor: '#00d5ffb9',
                    borderWidth: 3
                }]
        },

        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },

            plugins: {
                title: {
                    display: true,
                    text: 'Uso de CPU e RAM em porcentagem diariamente',
                    fontSize: 50,
                },
                legend: {
                    display: true,
                    position: 'bottom'
                },
            },
        }
    });

    const ctx2 = document.getElementById('myChart2');

    new Chart(ctx2, {
        data: {
            datasets: [{
                type: 'line',
                label: 'Gráfico de Rede',
                data: [12, 30, 3, 5, 2, 3],
                borderWidth: 2.5,
                tension: 0.4,
            },
            ],
            labels: ['1', '2', '3', '4', '5', '6',]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                },
                title: {
                    display: true,
                    fontSize: 20,
                    text: "Uso de rede  em decorrência do tempo",
                },
            }
        }
    });

    const ctx3 = document.getElementById('myChart3');

    new Chart(ctx3, {
        data: {
            datasets: [{
                type: 'bar',
                label: 'Uso do disco',
                data: [12, 19, 15, 12, 17],
                borderWidth: 1,
                backgroundColor: '#00d5ffb9',
            }],
            labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta']
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Uso de disco semanalmente'
                }
            },
            // scales: {
            //     y: {
            //         beginAtZero: true
            //     }
            // }
        }
    });
</script>

<script>
    document.getElementById("nomeUsuario").innerHTML = `Olá, ${sessionStorage.NOME_USUARIO}`
    var fkAme = sessionStorage.FK_AME

    function exibirNomeDoEstabelecimentoDeTrabalho() {

        fetch(`/dashboardEspecifica/nomeAme/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                console.log("Chegou aqui?")
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        console.log(resposta)
                        document.getElementById("teste").innerHTML = resposta[0].nomeAme
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function listarMaquinas() {
        var fkAme = sessionStorage.FK_AME

        fetch(`/dashboardEspecifica/listarMaquinas/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    console.log(response)
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        console.log(resposta);
                        for (var i = 0; i < resposta.length; i++) {
                            var idMaquina = sessionStorage.idMaquina = resposta[i].idMaquina
                            console.log(idMaquina)

                            if (resposta[i].statusMaquina == 1) {
                                resposta[i].statusMaquina = "Ativada"
                            } else {
                                resposta[i].statusMaquina = "Desativada"
                            }
                            document.getElementById("listaDeMaquinas").innerHTML += `${resposta[i].idMaquina} 
                        ${resposta[i].statusMaquina} <br><br>`
                        }
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpisParametroCpu() {
        let segundosCpuMedio = 0;
        let minutosCpuMedio = 0;

        let segundosCpuMáximo = 0;
        let minutosCpuMáximo = 0;

        fetch(`/dashboardEspecifica/kpisParametroCpu/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    console.log(response)
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        // setInterval(function () {
                        // }, 1000);
                        for (var i = 0; i < resposta.length; i++) {
                            if (resposta[i].qtdUsoCpu >= resposta[0].medio && resposta[i].qtdUsoCpu < resposta[0].maximo) {
                                if ((segundosCpuMedio++) == 60) {
                                    segundosCpuMedio = 0
                                    minutosCpuMedio++
                                    if (minutosCpuMedio == 60) {
                                        minutosCpuMedio = 0
                                    }
                                }
                            }

                            if (resposta[i].qtdUsoCpu >= resposta[0].maximo) {
                                segundosCpuMáximo++
                                if (segundosCpuMáximo == 60) {
                                    segundosCpuMáximo = 0
                                    minutosCpuMáximo++
                                }
                            }

                        }
                        document.getElementById("cpuPreocupante").innerHTML = `${minutosCpuMedio} : ${segundosCpuMedio}`
                        document.getElementById("cpuCritico").innerHTML = `${minutosCpuMáximo} : ${segundosCpuMáximo}`
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpisParametroRam() {
        let segundosRamMedio = 0;
        let minutosRamMedio = 0;

        let segundosRamMáximo = 0;
        let minutosRamMáximo = 0;

        fetch(`/dashboardEspecifica/kpisParametroRam/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    console.log(response)
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        for (var i = 0; i < resposta.length; i++) {
                            if (resposta[i].memoriaEmUso >= resposta[0].medio && resposta[i].memoriaEmUso < resposta[0].maximo) {
                                if ((segundosRamMedio++) == 60) {
                                    segundosRamMedio = 0
                                    minutosRamMedio++
                                    if (minutosRamMedio == 60) {
                                        minutosRamMedio = 0
                                    }
                                }
                            }

                            if (resposta[i].memoriaEmUso >= resposta[0].maximo) {
                                segundosRamMáximo++
                                if (segundosRamMáximo == 60) {
                                    segundosRamMáximo = 0
                                    minutosRamMáximo++
                                }
                            }
                        }
                        document.getElementById("ramPreocupante").innerHTML = `${minutosRamMedio} : ${segundosRamMedio}`
                        document.getElementById("ramCritico").innerHTML = `${minutosRamMáximo} : ${segundosRamMáximo}`
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpiRede() {
        let segundosRedeMedio = 0;
        let minutosRedeMedio = 0;
        let horasRedeMedio = 0;

        let segundosRedeMaximo = 0;
        let minutosRedeMaximo = 0;
        let horasRedeMaximo = 0;

        fetch(`/dashboardEspecifica/kpiRede/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    console.log(response)
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos de rede   : ${JSON.stringify(resposta)}`);

                        for (let i = 0; i < resposta.length; i++) {
                            if (resposta[i].bytesRecebido >= resposta[0].medio) {
                                segundosRedeMedio++
                                if (segundosRedeMedio == 60) {
                                    segundosRedeMedio = 0
                                    minutosRedeMedio++
                                    if (minutosRedeMedio == 60) {
                                        minutosRedeMedio = 0
                                        horasRedeMedio++
                                    }
                                }
                            }

                            if (resposta[i].bytesRecebido >= resposta[0].maximo) {
                                segundosRedeMaximo++
                                if (segundosRedeMaximo == 60) {
                                    segundosRedeMaximo = 0
                                    minutosRedeMaximo++
                                    if (minutosRedeMaximo == 60) {
                                        minutosRedeMaximo = 0
                                        horasRedeMaximo++
                                    }
                                }
                            }

                        }
                        document.getElementById("redePreocupante").innerHTML = `${minutosRedeMedio} : ${segundosRedeMedio}`
                        document.getElementById("redeCritico").innerHTML = `${minutosRedeMaximo} : ${segundosRedeMaximo}`
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpiTempoDisco() {
        let segundosDiscoMedio = 0;
        let minutosDiscoMedio = 0;

        let segundosDiscoMáximo = 0;
        let minutosDiscoMáximo = 0;

        fetch(`/dashboardEspecifica/kpiTempoDisco/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    console.log(response)
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        for (var i = 0; i < resposta.length; i++) {
                            if (resposta[i].usoAtualDisco >= resposta[0].medio && resposta[i].usoAtualDisco < resposta[0].maximo) {
                                if ((segundosDiscoMedio++) == 60) {
                                    segundosDiscoMedio = 0
                                    minutosDiscoMedio++
                                    if (minutosDiscoMedio == 60) {
                                        minutosDiscoMedio = 0
                                    }
                                }
                            }

                            if (resposta[i].usoAtualDisco >= resposta[0].maximo) {
                                segundosDiscoMáximo++
                                if (segundosDiscoMáximo == 60) {
                                    segundosDiscoMáximo = 0
                                    minutosDiscoMáximo++
                                }
                            }
                        }
                        document.getElementById("discoPreocupante").innerHTML = `${minutosDiscoMedio} : ${segundosDiscoMedio}`
                        document.getElementById("discoCritico").innerHTML = `${minutosDiscoMáximo} : ${segundosDiscoMáximo}`
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function informacoesMaquina() {
        fetch(`/dashboardEspecifica/informacoesMaquina/${fkAme}`,
            { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    console.log(response)
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        document.getElementById("nomeMaquina").innerHTML = resposta[0].hostName
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }
</script>